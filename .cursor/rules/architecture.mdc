---
description: ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã«é–¢ã™ã‚‹ãƒ«ãƒ¼ãƒ«
globs: app/src/**/*.ts
---

# ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ - ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€**ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**ã¨**ä¾å­˜æ€§æ³¨å…¥ãƒ‘ã‚¿ãƒ¼ãƒ³**ã«åŸºã¥ã„ãŸå®Ÿè£…ã§ã™ã€‚

### ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã¨è²¬ä»»

```
domain/
â”œâ”€â”€ [feature]/               # æ©Ÿèƒ½åˆ¥ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
â”‚   â”œâ”€â”€ [feature].ts        # ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤ - ãƒ¡ã‚¤ãƒ³API
â”‚   â”œâ”€â”€ repositories/       # ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤ - ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”œâ”€â”€ services/           # ã‚µãƒ¼ãƒ“ã‚¹å±¤ - å¤–éƒ¨APIæ“ä½œ
â”‚   â”œâ”€â”€ mappers/            # ãƒ‡ãƒ¼ã‚¿å¤‰æ›å±¤ - ãƒ¢ãƒ‡ãƒ«å¤‰æ›
â”‚   â”œâ”€â”€ factories/          # ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ - ä¾å­˜æ€§æ³¨å…¥
â”‚   â””â”€â”€ README.md           # ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â””â”€â”€ model.ts                # ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«
```

## ğŸ¯ è¨­è¨ˆåŸå‰‡

### 1. **ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®å³å®ˆ**

```typescript
// âœ… æ­£ã—ã„ä¾å­˜é–¢ä¿‚ã®æ–¹å‘
[feature].ts â†’ [Feature]Repository â†’ [Feature]Service â†’ [Feature]Mapper

// âŒ é€†æ–¹å‘ã®ä¾å­˜é–¢ä¿‚ã¯ç¦æ­¢
[Feature]Mapper â†’ [Feature]Repository  // ç¦æ­¢
```

### 2. **ä¾å­˜æ€§æ³¨å…¥ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä½¿ç”¨**

```typescript
// âœ… ServiceFactoryã‚’ä½¿ç”¨ã—ãŸä¾å­˜æ€§æ³¨å…¥
const repository = ServiceFactory.getService<[Feature]Repository>('[feature]Repository');

// âŒ ç›´æ¥ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã¯ç¦æ­¢
const repository = new [Feature]Repository(...);  // ç¦æ­¢
```

### 3. **çµ±ä¸€ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**

```typescript
// âœ… ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼ã‚’ä½¿ç”¨ã—ãŸæ§‹é€ åŒ–ã‚¨ãƒ©ãƒ¼
throw new [Feature]Error('ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ã‚¨ãƒ©ãƒ¼', ERROR_CODES.DATABASE_NOT_FOUND);

// âŒ ä¸€èˆ¬çš„ãªErrorã¯ç¦æ­¢
throw new Error('ã‚¨ãƒ©ãƒ¼');  // ç¦æ­¢
```

## ğŸ”§ å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

### 1. **Repository ãƒ‘ã‚¿ãƒ¼ãƒ³**

Repository ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å®Ÿè£…ä¾‹ï¼š

```typescript
export class [Feature]Repository {
  // ä¾å­˜æ€§æ³¨å…¥ã«ã‚ˆã‚‹ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿
  constructor(
    private service: [Feature]Service,
    private mapper: [Feature]Mapper,
    private logger: ILogger,
    private cache: ICache<[Feature][]>
  ) {}

  // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä»˜ããƒ‡ãƒ¼ã‚¿å–å¾—
  async fetch[Features](id: string): Promise<[Feature][]> {
    const cacheKey = `[features]:${id}`;
    const cached = this.cache.get(cacheKey);
    if (cached) return cached;

    // ãƒ‡ãƒ¼ã‚¿å–å¾—ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä¿å­˜
    const data = await this.service.queryData(id);
    this.cache.set(cacheKey, data);
    return data;
  }
}
```

### 2. **Service ãƒ‘ã‚¿ãƒ¼ãƒ³**

Service ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å®Ÿè£…ä¾‹ï¼š

```typescript
export class [Feature]Service {
  // ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½ä»˜ãAPIå‘¼ã³å‡ºã—
  async queryData(id: string): Promise<[Feature]Response> {
    return await this.retryManager.execute(async () => {
      return await this.externalApi.query({
        id: id,
      });
    });
  }
}
```

### 3. **Mapper ãƒ‘ã‚¿ãƒ¼ãƒ³**

Mapper ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å®Ÿè£…ä¾‹ï¼š

```typescript
export class [Feature]Mapper {
  // å‹å®‰å…¨ãªå¤‰æ›
  async mapTo[Feature](data: [Feature]Response, content: ContentResponse): Promise<[Feature]> {
    const [feature] = this.create[Feature]Model(data, content);
    ValidatorFactory.validate[Feature]([feature]);  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¿…é ˆ
    return [feature];
  }
}
```

### 4. **Factory ãƒ‘ã‚¿ãƒ¼ãƒ³**

Factory ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å®Ÿè£…ä¾‹ï¼š

```typescript
export class ServiceFactory {
  static initialize(): void {
    this.container = DIContainer.getInstance();
    this.registerServices();
  }

  static getService<T>(token: string): T {
    return this.container.resolve<T>(token);
  }
}
```

## ğŸ“‹ å®Ÿè£…ãƒ«ãƒ¼ãƒ«

### 1. **æ–°ã—ã„Repositoryã®è¿½åŠ **

```typescript
// 1. Repositoryã‚¯ãƒ©ã‚¹ã‚’ä½œæˆ
export class [Feature]Repository {
  constructor(
    private service: [Feature]Service,
    private logger: ILogger,
    private cache: ICache<[Feature][]>
  ) {}
}

// 2. ServiceFactoryã«ç™»éŒ²
private static registerServices(): void {
  this.container.register('[feature]Repository', new [Feature]Repository(...));
}

// 3. [feature].tsã§å…¬é–‹APIã‚’è¿½åŠ 
export async function fetch[Features](): Promise<FetchResult<[Feature][]>> {
  // å®Ÿè£…
}
```

### 2. **æ–°ã—ã„Serviceã®è¿½åŠ **

```typescript
// 1. Serviceã‚¯ãƒ©ã‚¹ã‚’ä½œæˆ
export class [Feature]Service {
  constructor(
    private logger: ILogger,
    private cache: ICache<[Feature]Type>,
    private retryManager: RetryManager
  ) {}
}

// 2. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½ã‚’å¿…ãšå®Ÿè£…
```

### 3. **æ–°ã—ã„Mapperã®è¿½åŠ **

```typescript
// 1. Mapperã‚¯ãƒ©ã‚¹ã‚’ä½œæˆ
export class [Feature]Mapper {
  constructor(private logger: ILogger) {}

  // 2. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã‚’å¿…ãšå®Ÿè£…
  async mapTo[Feature](data: any): Promise<[Feature]> {
    const [feature] = this.create[Feature](data);
    ValidatorFactory.validate[Feature]([feature]);
    return [feature];
  }
}
```

## ğŸš« ç¦æ­¢äº‹é …

### 1. **ç›´æ¥çš„ãªä¾å­˜é–¢ä¿‚**

```typescript
// âŒ ç¦æ­¢: ç›´æ¥çš„ãªã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–
const service = new [Feature]Service(...);

// âŒ ç¦æ­¢: å¾ªç’°ä¾å­˜
// ServiceA â†’ ServiceB â†’ ServiceA
```

### 2. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ä¸å‚™**

```typescript
// âŒ ç¦æ­¢: ä¸€èˆ¬çš„ãªErrorã®ä½¿ç”¨
throw new Error('ã‚¨ãƒ©ãƒ¼');

// âŒ ç¦æ­¢: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®çœç•¥
try {
  await someOperation();
} catch (error) {
  // ä½•ã‚‚ã—ãªã„ - ç¦æ­¢
}
```

### 3. **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®çœç•¥**

```typescript
// âŒ ç¦æ­¢: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãªã—ã®ãƒ‡ãƒ¼ã‚¿å¤‰æ›
return { name: data.name };  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãªã—

// âŒ ç¦æ­¢: å…¥åŠ›å€¤ã®æ¤œè¨¼ãªã—
async function processData(input: any) {
  // inputã®æ¤œè¨¼ãªã— - ç¦æ­¢
}
```

## âœ… å¿…é ˆå®Ÿè£…é …ç›®

### 1. **ã™ã¹ã¦ã®ã‚¯ãƒ©ã‚¹ã§å¿…é ˆ**

- ä¾å­˜æ€§æ³¨å…¥ã«ã‚ˆã‚‹ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿
- ãƒ­ã‚°å‡ºåŠ›ã®å®Ÿè£…
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- å‹å®‰å…¨æ€§ã®ç¢ºä¿

### 2. **Repositoryå±¤ã§å¿…é ˆ**

- ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã®å®Ÿè£…
- ãƒ‡ãƒ¼ã‚¿å–å¾—ã®æœ€é©åŒ–
- ã‚¨ãƒ©ãƒ¼æ™‚ã®é©åˆ‡ãªãƒ­ã‚°å‡ºåŠ›

### 3. **Serviceå±¤ã§å¿…é ˆ**

- ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½ã®å®Ÿè£…
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½

### 4. **Mapperå±¤ã§å¿…é ˆ**

- å‹å®‰å…¨ãªå¤‰æ›
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½
- ã‚¨ãƒ©ãƒ¼æ™‚ã®è©³ç´°ãƒ­ã‚°

## ğŸ” ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### 1. **å˜ä½“ãƒ†ã‚¹ãƒˆ**

```typescript
// ServiceFactoryã®ãƒªã‚»ãƒƒãƒˆ
ServiceFactory.reset();

// ãƒ¢ãƒƒã‚¯ã®æ³¨å…¥
const mockLogger = new MockLogger();
ServiceFactory.register('logger', mockLogger);
```

### 2. **çµ±åˆãƒ†ã‚¹ãƒˆ**

```typescript
// å®Ÿéš›ã®APIã‚’ä½¿ç”¨ã—ãŸãƒ†ã‚¹ãƒˆ
const result = await fetchHabits();
expect(result.success).toBe(true);
```

## ğŸ“š å‚è€ƒè³‡æ–™

- å„æ©Ÿèƒ½ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®README.md - è©³ç´°ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [feature].ts - ãƒ¡ã‚¤ãƒ³APIã®å®Ÿè£…ä¾‹
- factories/ServiceFactory.ts - ä¾å­˜æ€§æ³¨å…¥ã®å®Ÿè£…ä¾‹

ã“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¯ã€**ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**ã€**ä¿å®ˆæ€§**ã€**ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£**ã€**ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**ã‚’ã™ã¹ã¦è€ƒæ…®ã—ãŸå®Ÿè£…ã§ã™ã€‚
